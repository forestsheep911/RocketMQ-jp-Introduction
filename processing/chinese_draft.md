# RocketMQ 介绍

## 概要
RocketMQ是由阿里开发的消息中间件，开发灵感受到了Kafka的影响，吸取了很多Kafka的优点，并根据自身需求进行了改造和优化。RocketMQ的一个重要特性是支持非日志类型的可靠消息传送。目前广泛应用于阿里集团下各类产品中，在订单，交易，充值，流计算，消息推送等场景中起到了重要作用。

## Rocket开发的契机和动机
阿里集团下的淘宝原先就使用自己开发的Notify消息中间件，使用的是Mysql作为存储手段，但希望进一步优化存储部分。2011年初，Linkin开源了Kafka这个优秀的消息中间件，淘宝中间件团队在对Kafka做过充分Review之后，认为Kafka的无限消息堆积，高效持久化速度等特性非常优秀。但另一方面，Kafka主要定位于日志传输，但淘宝最常用的是和交易相关的一系列对事务完整性要求很高的业务。kafka并不擅长这方面，所以阿里决定重新用Java编写一套新的中间件，命名为RocketMQ。

对于kafka无法照搬和开发新中间件的具体考量如下：
* Kafka的业务应用场景主要定位于日志传输；对于复杂业务支持不够。
* 阿里很多业务场景对数据可靠性、数据实时性、消息队列的个数等方面的要求很高。
* kafka针对海量数据，但是对数据的正确度要求不是十分严格。而阿里巴巴中用于交易相关的事情较多，对数据的正确性要求极高，Kafka不合适。
* 当业务成长到一定规模，采用开源方案的技术成本会变高.
* 开源方案无法满足业务的需要；旧版本、自开发代码与新版本的兼容都可能是问题；运维角度，Kafka使用 scala 编写，而阿里是java系。Kafka的后续维护是个问题。
* 阿里在团队、成本、资源投入等方面约束性条件几乎没有。

## 特点(和kafka的比较）
RocketMQ具有很多优秀的性能，尤其适应那些需要严格事务运用的场合。下面通过几个方面进行介绍。

> ~~注：因为RocketMQ和Kafka有着一定的渊源，而且Kafka也是目前运用较为广泛的，所以我们在讲述时K有时需要用Kafka作为对比，来更好的帮助读者了解RocketMQ。~~

### 数据可靠性
RocketMQ支持异步实时刷盘，同步刷盘，同步复制，异步复制。具有高可靠性。不会因为操作系统的崩溃而导致数据丢失。同步复制理论上性能高于Kafka。

### 性能
RocketMQ单机写入TPS单实例约7万条/秒，单机部署3个Broker，可以跑到最高12万条/秒，消息大小10个字节
低于kafka的百万条/秒。但是RocketMQ在队列数上有很大提升。kafka在64个队列以上就会明显增加响应时间，RocketMQ单机最高支持5万个队列，且负载不会发生明显变化。

### 消息投递实时性
RocketMQ采用长轮询，消息投递延迟通常在几个毫秒左右。

### 消费失败重试
RocketMQ支持消费失败重试，这个特性非常适合运用在充值方面的应用。Kafka则不支持。

### 严格的消息顺序
RocketMQ支持严格的意义上的消息顺序。即时在一台Broker宕机后，消息发送会失败，但是不会乱序。
kafka也支持消息顺序，但一台Broker宕机后，消息会混乱。

### 定时消息
RocketMQ支持定时消息，Kafka则不支持。

### 分布式事务消息
RocketMQ支持定时消息，Kafka则不支持。

### 消息查询
RocketMQ支持根据消息标识或内容查询。kafka则不支持。

### 消息回溯
RocketMQ支持按照时间来回溯消息，精度毫秒，例如从一天之前的某时某分某秒开始重新消费消息。

kafka可以按照偏移来回溯消息。

### 开发语言
RocketMQ采用Java编写。

kafka则采用Scala编写。

### 成熟度
RocketMQ在阿里集团内部得到了大量的运用。每天都产生海量的消息，并且顺利经过了多次双十一的考验。

Kafka在日志领域有着很高的成熟度。



## 文献参照

[RocketMQ与kafka对比（18项差异）](http://jm.taobao.org/2016/03/24/rmq-vs-kafka/)
[技术选型：RocketMQ or Kafka](https://zhuanlan.zhihu.com/p/60196818)